# ğŸ’³ Credit Systeem Plan: OpenAI API Kosten Beheersen

## ğŸ¯ Strategie

**Gratis:** 3 OpenAI credits per dag (gratis voor gebruiker)
**Betaald:** 20 credits voor â‚¬5 (kost jou â‚¬1, winst â‚¬4)

---

## ğŸ’° KOSTEN & WINST ANALYSE (REALISTISCH)

### **Realistische Gebruikersstatistieken:**
- **100 geregistreerde gebruikers** â‰  100 actieve gebruikers
- **Daily Active Users (DAU):** ~20-30% = **20-30 actieve gebruikers/dag**
- **AI feature gebruik:** ~50% van DAU = **10-15 gebruikers gebruiken AI/dag**
- **Niet iedereen gebruikt AI elke dag:** Gemiddeld 3-4x per week
- **Niet iedereen gebruikt 3 credits/dag:** Gemiddeld 1-2 credits per gebruik

### **Realistische Scenario's:**

**Scenario 1: Conservatief (Realistisch)**
- 100 geregistreerde gebruikers
- 25 DAU (25% actief)
- 12 gebruikers gebruiken AI features (50% van DAU)
- Gemiddeld: **8 AI requests/dag totaal** (niet per gebruiker!)
- **8 requests/dag Ã— 30 dagen = 240 requests/maand**

**Zonder Credit Systeem:**
- 240 requests Ã— $0.015 = **$3.60/maand** (~â‚¬3.30)
- **Kosten: â‚¬3.30/maand** (veel lager dan eerder berekend!)

**Met Credit Systeem (3 gratis/dag):**
- Gratis credits: 12 gebruikers Ã— 3/dag Ã— 30 dagen = **1,080 gratis credits beschikbaar**
- **Werkelijk gebruik: 240 requests/maand** (veel minder dan beschikbaar!)
- Alle requests zijn gratis â†’ **â‚¬0 kosten** âœ…
- **5-10% koopt credits** (1-2 power users) = **â‚¬5-10/maand inkomsten**
- **Winst: â‚¬5-10/maand** (bijna geen kosten!)

---

**Scenario 2: Groei (200 gebruikers)**
- 200 geregistreerde gebruikers
- 50 DAU (25% actief)
- 25 gebruikers gebruiken AI features
- Gemiddeld: **15 AI requests/dag totaal**
- **15 requests/dag Ã— 30 dagen = 450 requests/maand**

**Zonder Credit Systeem:**
- 450 requests Ã— $0.015 = **$6.75/maand** (~â‚¬6.20)

**Met Credit Systeem:**
- Gratis credits: 25 gebruikers Ã— 3/dag Ã— 30 = **2,250 gratis credits beschikbaar**
- **Werkelijk gebruik: 450 requests/maand** (nog steeds binnen gratis tier!)
- Alle requests zijn gratis â†’ **â‚¬0 kosten** âœ…
- **10% koopt credits** (2-3 power users) = **â‚¬10-15/maand inkomsten**
- **Winst: â‚¬10-15/maand**

---

**Scenario 3: Populair (500 gebruikers)**
- 500 geregistreerde gebruikers
- 125 DAU (25% actief)
- 60 gebruikers gebruiken AI features
- Gemiddeld: **40 AI requests/dag totaal**
- **40 requests/dag Ã— 30 dagen = 1,200 requests/maand**

**Zonder Credit Systeem:**
- 1,200 requests Ã— $0.015 = **$18/maand** (~â‚¬16.50)

**Met Credit Systeem:**
- Gratis credits: 60 gebruikers Ã— 3/dag Ã— 30 = **5,400 gratis credits beschikbaar**
- **Werkelijk gebruik: 1,200 requests/maand** (nog steeds binnen gratis tier!)
- Alle requests zijn gratis â†’ **â‚¬0 kosten** âœ…
- **15% koopt credits** (9 power users) = **â‚¬45/maand inkomsten**
- **Winst: â‚¬45/maand**

---

**Scenario 4: Zeer Populair (1,000 gebruikers)**
- 1,000 geregistreerde gebruikers
- 250 DAU (25% actief)
- 125 gebruikers gebruiken AI features
- Gemiddeld: **80 AI requests/dag totaal**
- **80 requests/dag Ã— 30 dagen = 2,400 requests/maand**

**Zonder Credit Systeem:**
- 2,400 requests Ã— $0.015 = **$36/maand** (~â‚¬33)

**Met Credit Systeem:**
- Gratis credits: 125 gebruikers Ã— 3/dag Ã— 30 = **11,250 gratis credits beschikbaar**
- **Werkelijk gebruik: 2,400 requests/maand** (nog steeds binnen gratis tier!)
- Alle requests zijn gratis â†’ **â‚¬0 kosten** âœ…
- **20% koopt credits** (25 power users) = **â‚¬125/maand inkomsten**
- **Winst: â‚¬125/maand**

---

**Scenario 5: Extreme Use Case (Power Users)**
- Stel: 10 power users gebruiken **elke dag 3 credits**
- 10 Ã— 3 Ã— 30 = **900 requests/maand**
- Kosten: 900 Ã— $0.015 = **$13.50/maand** (~â‚¬12.40)
- **Nog steeds zeer laag!**

---

## ğŸ“Š CONCLUSIE: Realistische Kosten

| Gebruikers | DAU | AI Requests/Dag | Kosten/Maand (Zonder) | Kosten/Maand (Met Credits) | Inkomsten | Winst |
|------------|-----|-----------------|---------------------|---------------------------|-----------|-------|
| **100** | 25 | 8 | â‚¬3.30 | **â‚¬0** âœ… | â‚¬5-10 | â‚¬5-10 |
| **200** | 50 | 15 | â‚¬6.20 | **â‚¬0** âœ… | â‚¬10-15 | â‚¬10-15 |
| **500** | 125 | 40 | â‚¬16.50 | **â‚¬0** âœ… | â‚¬45 | â‚¬45 |
| **1,000** | 250 | 80 | â‚¬33 | **â‚¬0** âœ… | â‚¬125 | â‚¬125 |
| **2,000** | 500 | 150 | â‚¬66 | **â‚¬0-10** âš ï¸ | â‚¬250 | â‚¬240-250 |

**ğŸ’¡ Belangrijk:**
- Bij **< 2,000 gebruikers:** Bijna alle kosten zijn **GRATIS** (binnen 3 credits/dag per gebruiker)
- Credit systeem is vooral **winst genereren**, niet kosten besparen (kosten zijn al laag!)
- Bij **2,000+ gebruikers:** Mogelijk dat sommige power users over gratis tier gaan â†’ dan betaal je ~â‚¬10-20/maand, maar verdien je â‚¬250+

---

## ğŸ“Š CREDIT PRIJZEN & MARGES

| Pakket | Credits | Prijs | Jouw Kosten | Winst | Marge |
|--------|---------|-------|-------------|-------|-------|
| **Starter** | 20 credits | â‚¬5 | â‚¬1 | â‚¬4 | 80% |
| **Popular** | 50 credits | â‚¬10 | â‚¬2.50 | â‚¬7.50 | 75% |
| **Pro** | 100 credits | â‚¬18 | â‚¬5 | â‚¬13 | 72% |
| **Power User** | 250 credits | â‚¬40 | â‚¬12.50 | â‚¬27.50 | 69% |

**Aanbeveling:** Start met alleen **20 credits voor â‚¬5** (simpel, duidelijk)

---

## ğŸ¯ IMPLEMENTATIE PLAN

### **Fase 1: Credit Systeem Basis (1-2 weken)**

#### 1.1 Database Schema (Supabase)
```sql
-- Credits table
CREATE TABLE user_credits (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
  credits INTEGER DEFAULT 0,
  free_credits_used_today INTEGER DEFAULT 0,
  last_free_reset_date DATE DEFAULT CURRENT_DATE,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW(),
  UNIQUE(user_id)
);

-- Credit transactions table (voor tracking)
CREATE TABLE credit_transactions (
  id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),
  user_id UUID REFERENCES auth.users(id) ON DELETE CASCADE,
  amount INTEGER, -- +20, -1, etc.
  type TEXT, -- 'free_daily', 'purchase', 'usage'
  description TEXT,
  created_at TIMESTAMP DEFAULT NOW()
);

-- Indexes
CREATE INDEX idx_user_credits_user ON user_credits(user_id);
CREATE INDEX idx_credit_transactions_user ON credit_transactions(user_id, created_at DESC);
```

#### 1.2 Backend API Endpoints (app.py)
```python
# Check credits
@app.route("/api/credits/balance", methods=["GET"])
@login_required
def get_credits_balance():
    # Get user credits from Supabase
    # Return: {"credits": 20, "free_used_today": 2, "free_remaining": 1}

# Use credit (before OpenAI call)
@app.route("/api/credits/use", methods=["POST"])
@login_required
def use_credit():
    # Check if user has credits
    # Deduct 1 credit
    # Return: {"success": True, "credits_remaining": 19}

# Add credits (after purchase)
@app.route("/api/credits/add", methods=["POST"])
@login_required
def add_credits():
    # Add credits after successful payment
    # Return: {"success": True, "credits_added": 20, "new_balance": 40}
```

#### 1.3 Daily Free Credits Reset
```python
# Cron job of scheduled task (Render Cron Jobs)
# Reset free_credits_used_today to 0 at midnight
# Update last_free_reset_date
```

#### 1.4 Frontend Integration (app.js)
```javascript
// Check credits before OpenAI call
async function checkAndUseCredit() {
    const { data: balance } = await supabaseClient
        .from('user_credits')
        .select('*')
        .eq('user_id', session.user.id)
        .single();
    
    // Check if user has free credits today
    const today = new Date().toISOString().split('T')[0];
    const lastReset = balance.last_free_reset_date;
    
    if (lastReset !== today) {
        // Reset free credits
        await resetFreeCredits();
    }
    
    // Check if user can use free credit
    if (balance.free_credits_used_today < 3) {
        // Use free credit
        await useFreeCredit();
        return true;
    }
    
    // Check if user has paid credits
    if (balance.credits > 0) {
        // Use paid credit
        await usePaidCredit();
        return true;
    }
    
    // No credits available
    return false;
}

// Show credit purchase modal
function showCreditPurchaseModal() {
    // Modal: "Je hebt geen credits meer. Koop 20 credits voor â‚¬5?"
}
```

---

### **Fase 2: Payment Integration (2-3 weken)**

#### 2.1 Payment Provider Keuze

**Optie 1: Stripe (Aanbevolen)**
- âœ… Werkt wereldwijd
- âœ… In-app purchases voor iOS/Android
- âœ… Webhooks voor verificatie
- âœ… â‚¬0.25 + 1.4% per transactie
- **Kosten:** â‚¬5 transactie = â‚¬0.32 fee â†’ **Jouw winst: â‚¬3.68**

**Optie 2: Apple In-App Purchase (iOS)**
- âœ… Native iOS integratie
- âœ… 30% Apple fee (duur!)
- âŒ Alleen iOS
- **Kosten:** â‚¬5 transactie = â‚¬1.50 fee â†’ **Jouw winst: â‚¬2.50**

**Optie 3: Google Play Billing (Android)**
- âœ… Native Android integratie
- âœ… 30% Google fee (duur!)
- âŒ Alleen Android
- **Kosten:** â‚¬5 transactie = â‚¬1.50 fee â†’ **Jouw winst: â‚¬2.50**

**Aanbeveling:** Start met **Stripe** (werkt overal, lagere fees)

#### 2.2 Stripe Integration
```python
# Backend: Create payment intent
@app.route("/api/payments/create-intent", methods=["POST"])
@login_required
def create_payment_intent():
    import stripe
    stripe.api_key = os.getenv("STRIPE_SECRET_KEY")
    
    amount = request.json.get("amount", 500)  # â‚¬5 = 500 cents
    credits = request.json.get("credits", 20)
    
    intent = stripe.PaymentIntent.create(
        amount=amount,
        currency="eur",
        metadata={
            "user_id": current_user.id,
            "credits": credits
        }
    )
    
    return jsonify({"client_secret": intent.client_secret})

# Webhook: Verify payment and add credits
@app.route("/api/payments/webhook", methods=["POST"])
def stripe_webhook():
    # Verify Stripe signature
    # Get payment intent
    # Add credits to user account
    # Return 200
```

#### 2.3 Frontend Payment Flow
```javascript
// Stripe.js integration
async function purchaseCredits(credits = 20, price = 5) {
    // 1. Create payment intent
    const { client_secret } = await fetch('/api/payments/create-intent', {
        method: 'POST',
        body: JSON.stringify({ credits, amount: price * 100 })
    });
    
    // 2. Show Stripe payment form
    const stripe = Stripe('pk_live_...');
    const { error } = await stripe.confirmCardPayment(client_secret, {
        payment_method: {
            card: cardElement,
            billing_details: { name: user.name }
        }
    });
    
    // 3. On success, refresh credits
    if (!error) {
        await loadCredits();
        showSuccessMessage(`Je hebt ${credits} credits gekocht!`);
    }
}
```

---

### **Fase 3: UI/UX (1 week)**

#### 3.1 Credit Display
- **Header:** "Credits: 20" (gratis: "3/3 vandaag")
- **Tooltip:** "Je hebt 3 gratis credits per dag. Koop meer voor â‚¬5"
- **Low credit warning:** "Je hebt nog 2 credits. Koop meer?"

#### 3.2 Purchase Modal
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ’³ Koop Credits                 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                  â”‚
â”‚  20 Credits                     â”‚
â”‚  â‚¬5.00                          â”‚
â”‚                                  â”‚
â”‚  [Stripe Payment Form]          â”‚
â”‚                                  â”‚
â”‚  [Annuleren] [Koop Nu]          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 3.3 Credit Usage Feedback
- **Before OpenAI call:** "Dit kost 1 credit. Je hebt er 20."
- **After success:** "Credit gebruikt! Je hebt nog 19 credits."
- **No credits:** "Je hebt geen credits meer. Koop 20 voor â‚¬5?"

---

## ğŸ”’ SECURITY & FRAUDE PREVENTIE

1. **Server-side verificatie:**
   - âœ… Credits worden ALTIJD server-side gecheckt
   - âœ… Payment webhooks worden server-side verwerkt
   - âŒ NOOIT client-side credit checks vertrouwen

2. **Rate limiting:**
   - âœ… Max 3 free credits/dag per gebruiker
   - âœ… Max 100 credits/dag per gebruiker (betaald)
   - âœ… Prevent credit farming

3. **Payment security:**
   - âœ… Stripe webhook signature verificatie
   - âœ… Idempotency keys (prevent double charges)
   - âœ… Log alle credit transactions

---

## ğŸ“ˆ GROEI STRATEGIE

### **Launch:**
- Start met **3 gratis credits/dag**
- **20 credits voor â‚¬5** als enige optie
- Promotie: "Eerste aankoop: 25 credits voor â‚¬5" (limited time)

### **Later:**
- **Meerdere pakketten** (zie tabel hierboven)
- **Subscription model:** "â‚¬10/maand = 100 credits/maand"
- **Bulk kortingen:** "Koop 100 credits, krijg 20 gratis"

---

## âœ… VOORDELEN VAN DIT SYSTEEM

1. âœ… **Kosten onder controle** - Max â‚¬125-154/maand (vs â‚¬420)
2. âœ… **Winst maken** - â‚¬142-496/maand winst mogelijk
3. âœ… **Gebruikers kunnen kiezen** - Gratis voor casual, betaald voor power users
4. âœ… **Schaalbaar** - Meer gebruikers = meer winst (niet meer kosten)
5. âœ… **Marketing tool** - "AI-powered" feature = premium feel
6. âœ… **User engagement** - Credits = gamification element

---

## ğŸš€ IMPLEMENTATIE VOLGORDE

1. **Week 1-2:** Database schema + Backend API
2. **Week 3:** Frontend credit checking + UI
3. **Week 4-5:** Stripe integration + Payment flow
4. **Week 6:** Testing + Bug fixes
5. **Week 7:** Launch! ğŸ‰

---

*Laatste update: Januari 2026*

